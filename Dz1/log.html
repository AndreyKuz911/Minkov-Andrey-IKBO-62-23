<p>test_user: import os в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: import zipfile в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: from datetime import datetime в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: import html в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: class ShellEmulator: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def __init__(self, username, zip_path, log_path): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.username = username в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.zip_path = zip_path в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.log_path = log_path в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.current_directory = &#x27;/Fs&#x27;  # Инициализация корневого каталога в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.filesystem = self.load_filesystem(zip_path)  # Загрузка файловой системы в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def load_filesystem(self, zip_path): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Загрузить файловую систему из ZIP-файла.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: filesystem = {} в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: with zipfile.ZipFile(zip_path, &#x27;r&#x27;) as zip_ref: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: for file_name in zip_ref.namelist(): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: parts = file_name.split(&#x27;/&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level = filesystem в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: for part in parts[:-1]:  # Создание структуры каталогов в файловой системе в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if part not in current_level: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level[part] = {} в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level = current_level[part] в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if parts[-1]:  # Если это не каталог в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: try: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: content = zip_ref.read(file_name).decode(&#x27;utf-8&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: except UnicodeDecodeError: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: content = zip_ref.read(file_name).decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level[parts[-1]] = { в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &#x27;content&#x27;: content, в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &#x27;owner&#x27;: &#x27;default_owner&#x27;  # Убедитесь, что этот ключ присутствует в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: } в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return filesystem в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def log_command(self, command): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Записывает команду в лог-файл в формате HTML.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: timestamp = datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_dir = self.current_directory в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: with open(self.log_path, mode=&#x27;a&#x27;) as log_file: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: log_file.write(f&quot;&lt;p&gt;{html.escape(self.username)}: {html.escape(command)} в {html.escape(current_dir)} - {timestamp}&lt;/p&gt;\n&quot;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def execute_command(self, command): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Выполняет команду и возвращает результат.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.log_command(command) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: parts = command.split() в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if not parts: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return &quot;Пустая команда.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: cmd = parts[0] в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: try: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if cmd == &#x27;ls&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return self.ls() в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: elif cmd == &#x27;cd&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return self.cd(parts[1] if len(parts) &gt; 1 else &#x27;&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: elif cmd == &#x27;mv&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return self.mv(parts[1], parts[2]) if len(parts) == 3 else &quot;Использование: mv &lt;source&gt; &lt;destination&gt;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: elif cmd == &#x27;tail&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return self.tail(parts[1]) if len(parts) &gt; 1 else &quot;Использование: tail &lt;file&gt;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: elif cmd == &#x27;exit&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return &quot;Выход из эмулятора.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Команда &#x27;{cmd}&#x27; не поддерживается.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: except Exception as e: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Ошибка: {str(e)}&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def ls(self): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Выводит список файлов и директорий в текущем каталоге.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level = self.get_current_directory() в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if current_level: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: output = [] в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: for item, properties in current_level.items(): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: owner = properties.get(&#x27;owner&#x27;, &#x27;неизвестный владелец&#x27;)  # Используйте get для безопасного доступа в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: output.append(f&quot;{item} (владелец: {owner})&quot;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return &#x27;\n&#x27;.join(output) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return &quot;Директория не найдена.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def cd(self, path): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Сменяет текущую директорию или выводит текущую директорию, если путь не указан.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if not path: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;{self.current_directory}&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if path == &quot;..&quot;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if self.current_directory != &#x27;/Fs&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: parts = self.current_directory.strip(&#x27;/&#x27;).split(&#x27;/&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: parts.pop()  # Удаляем последний элемент (каталог) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if parts: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.current_directory = &#x27;/&#x27; + &#x27;/&#x27;.join(parts) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: else: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.current_directory = &#x27;/Fs&#x27; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return &quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: target = path.strip(&#x27;/&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level = self.get_current_directory() в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if target in current_level: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: self.current_directory += &#x27;/&#x27; + target if not target.startswith(&#x27;/&#x27;) else target в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Сменена директория на: {self.current_directory}&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Директория &#x27;{path}&#x27; не найдена.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def mv(self, source_file, destination_file): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Перемещает файл из source_file в destination_file.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level = self.get_current_directory() в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if source_file in current_level: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level[destination_file] = current_level.pop(source_file) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Файл &#x27;{source_file}&#x27; перемещен в &#x27;{destination_file}&#x27;.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Файл &#x27;{source_file}&#x27; не найден.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def tail(self, file_name): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Выводит последние 10 строк указанного файла.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level = self.get_current_directory() в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if not current_level or file_name not in current_level: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Файл &#x27;{file_name}&#x27; не найден.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: file_content = current_level[file_name].get(&#x27;content&#x27;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if file_content is None or file_content.strip() == &quot;&quot;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return f&quot;Файл &#x27;{file_name}&#x27; пуст или недоступен.&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: lines = file_content.splitlines()[-10:] в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return &#x27;\n&#x27;.join(lines) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: def get_current_directory(self): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: &quot;&quot;&quot;Возвращает содержимое текущей директории.&quot;&quot;&quot; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level=self.filesystem в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: for part in self.current_directory.strip(&#x27;/&#x27;).split(&#x27;/&#x27;): в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if part: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: current_level=current_level.get(part) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if current_level is None: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return None в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: return current_level в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if __name__ == &#x27;__main__&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: username=&#x27;test_user&#x27; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: zip_path=&#x27;Fs.zip&#x27; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: log_path=&#x27;log.html&#x27; в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: emulator=ShellEmulator(username,zip_path,log_path) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: while True: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: command=input(f&quot;{username}@emulator:~$ &quot;) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: output=emulator.execute_command(command) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: print(output) в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: if command==&#x27;exit&#x27;: в /Fs - 2024-11-25 18:13:03</p>
<p>test_user: break в /Fs - 2024-11-25 18:13:03</p>
<p>user: ls в /Fs - 2024-11-25 18:13:43</p>
<p>user: ls в /Fs - 2024-11-25 18:13:48</p>
<p>user: mv в /Fs - 2024-11-25 18:13:53</p>
<p>user: mv file1.txt file1_moved.txt в /Fs - 2024-11-25 18:14:06</p>
<p>user: ls в /Fs - 2024-11-25 18:14:17</p>
<p>user: cd subdir1 в /Fs - 2024-11-25 18:14:22</p>
<p>user: ls в /Fs/subdir1 - 2024-11-25 18:14:28</p>
<p>user: mv file1.txt file1_moved.txt в /Fs/subdir1 - 2024-11-25 18:14:35</p>
<p>user: ls в /Fs/subdir1 - 2024-11-25 18:14:40</p>
<p>user: tail file1_moved.txt в /Fs/subdir1 - 2024-11-25 18:14:46</p>
<p>user: cd .. в /Fs - 2024-11-25 18:16:58</p>
<p>user: ls в /Fs - 2024-11-25 18:17:01</p>
<p>user: cd .. в /Fs - 2024-11-25 18:17:05</p>
<p>user: cd .. в /Fs - 2024-11-25 18:17:08</p>
<p>user: ls в /Fs - 2024-11-25 18:17:10</p>
<p>user: ls в /Fs - 2024-11-25 18:17:14</p>
<p>user: cd в /Fs - 2024-11-25 18:17:25</p>
<p>user: utyrr в /Fs - 2024-11-25 18:21:45</p>
<p>user: ls в /Fs - 2024-11-25 18:21:48</p>
<p>user: cd в /Fs - 2024-11-25 18:21:52</p>
<p>user: ls в /Fs - 2024-11-25 18:21:58</p>
<p>user: cd .. в /Fs - 2024-11-25 18:22:03</p>
<p>user: cd .. в /Fs - 2024-11-25 18:22:06</p>
<p>user: ls в /Fs - 2024-11-25 18:22:08</p>
<p>user: cd subdir1 в /Fs - 2024-11-25 18:22:17</p>
<p>user: ls в /Fs/subdir1 - 2024-11-25 18:22:19</p>
<p>user: cd .. в /Fs/subdir1 - 2024-11-25 18:22:21</p>
<p>user: ls в /Fs - 2024-11-25 18:22:24</p>
<p>user: cd subdir1 в /Fs - 2024-11-25 18:22:53</p>
<p>user: mv file1.txt file1_moved.txt в /Fs/subdir1 - 2024-11-25 18:22:59</p>
<p>user: ls в /Fs/subdir1 - 2024-11-25 18:23:03</p>
<p>user: tail file1_moved.txt в /Fs/subdir1 - 2024-11-25 18:23:20</p>
<p>user: cd subdir1 в /Fs - 2024-11-25 18:25:02</p>
<p>user: mv file1.txt file1_moved.txt в /Fs/subdir1 - 2024-11-25 18:25:10</p>
<p>user: tail file1_moved.txt в /Fs/subdir1 - 2024-11-25 18:25:16</p>
